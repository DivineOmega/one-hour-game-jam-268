pico-8 cartridge // http://www.pico-8.com
version 18
__lua__

score = 0
high_score = 0

game_over = false

maze = {}
objs = {}

function _init() 
 maze = generate_maze()
 
 add(objs, create_player())
end

function next_level()
 objs = {}
 score += 1
 _init()
end

function _update()
 if (score > high_score) then
  high_score = score
 end

 if (game_over) then
   game_over = false
   objs = {}
   score = 0
   _init()
   return
 end

 for obj in all(objs) do
  obj.update()
 end
 
end

function _draw()
 rectfill(0, 0, 128, 128, 0)
 
 for obj in all(objs) do
  obj.draw()
 end
 
 local y_offset = 12
 
 local x = 0
 local y = y_offset
 
 for row in all(maze) do
  for tile in all(row) do
   if (tile.left) then
    line(x, y, x, y+5, 1)
   end
   if (tile.right) then
    line(x+5, y, x+5, y+5, 1)
   end
   if (tile.up) then
    line(x, y, x+5, y, 1)
   end
   if (tile.down) then
    line(x, y+5, x+5, y+5, 1)
   end
   if (tile.finish) then
    circfill(x+2, y+2, 1, 10)
   end
   y += 5
  end
  y = y_offset
  x += 5
 end
 
 print("score: "..score.."  high: "..high_score, 30, 5, 7)

end

-->8

function generate_maze()
 local maze = {}
 
 local height = 20
 local width = 20

 for x = 1, width do
  maze[x] = {}
  for y = 1, height do
   maze[x][y] = create_tile()
  end
 end
 
 local loop_count = 0
 
 local cur_x = flr(width/2)
 local cur_y = flr(height/2)
 
 local ctile = nil
 
	while (true) do
 	::continue::
 	
 	loop_count += 1
 	
 	if (loop_count >= 10000) then
 	 break
 	end
	 
	 ctile = maze[cur_x][cur_y]
	 
	 local direc = flr(rnd(4))
	 
	 if (cur_y <= 1 and direc == 0) then
	  direc = 1
	 end
	 
	 if (cur_x <= 1 and direc == 2) then
	  direc = 3
	 end
	 
	 if (cur_y >= height and direc == 1) then
	  direc = 0
	 end
	 
	 if (cur_x >= width and direc == 3) then
	  direc = 2
	 end
	 
	 local ntile = nil
	 
	 if (direc == 0) then
	  ntile = maze[cur_x][cur_y-1]
	  if (ntile.visited) then
	   goto continue
	  end
	  ctile.up = false
	  ntile.down = false
	 elseif (direc == 1) then
 	 ntile = maze[cur_x][cur_y+1] 
 	 if (ntile.visited) then
	   goto continue
	  end
	  ctile.down = false
	  ntile.up = false
	 elseif (direc == 2) then
 	 ntile = maze[cur_x-1][cur_y]
 	 if (ntile.visited) then
	   goto continue
	  end 
	  ctile.left = false
	  ntile.right = false
	 elseif (direc == 3) then
 	 ntile = maze[cur_x+1][cur_y] 
 	 if (ntile.visited) then
	   goto continue
	  end
	  ctile.right = false
	  ntile.left = false
	 end
	 
	 ntile.visited = true
	 
	 if (direc == 0) then
	  cur_y -= 1
	 elseif (direc == 1) then
	  cur_y += 1
	 elseif (direc == 2) then
   cur_x -= 1
	 elseif (direc == 3) then
   cur_x += 1
	 end
	 
	end
	
	ctile.finish = true
	 
 return maze
end
-->8

function create_tile()
 local tile = {}
 
 tile.left = true
 tile.right = true
 tile.up = true
 tile.down = true
 
 tile.visited = false
 tile.finish = false
 
 return tile
end
-->8

function create_player()
 local p = {}
 
 p.x = 45+2
 p.y = 12+45+2
 
 p.draw = function()
  pset (p.x, p.y, 7)
 end
 
 p.update = function()
  if (btn(0)) then
    p.x -= 1
  end
  if (btn(1)) then
   p.x += 1
  end
  if (btn(2)) then
    p.y -= 1
  end
  if (btn(3)) then
    p.y += 1
  end
  
  if (pget(p.x, p.y)==1) then
    game_over = true
  end
  
  if (pget(p.x, p.y)==10) then
    next_level()
  end
 end
 
 return p
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000007700770077077707770000000007770000000007070777007707070000000007770000000000000000000000000000000
00000000000000000000000000000070007000707070707000070000007070000000007070070070007070070000007070000000000000000000000000000000
00000000000000000000000000000077707000707077007700000000007070000000007770070070007770000000007070000000000000000000000000000000
00000000000000000000000000000000707000707070707000070000007070000000007070070070707070070000007070000000000000000000000000000000
00000000000000000000000000000077000770770070707770000000007770000000007070777077707070000000007770000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000000000100000000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000000000100000000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000000000100000000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000000000100000000000000000001000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111000010000100001111111111100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100000000000000000000000010a00100001000010000100001000000000000000000000000000
1000010000100001000010000100001000010000100001000010000000000000000000000001aaa0100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100000000000000000000000010a00100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100000000000000000000000010000100001000010000100001000000000000000000000000000
11111111111111111111111111111111111111111111111111100001111111111111111111111111100001111111111100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100000000010000100001000000000000001000000000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100000000010000100001000000000000001000000000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100000000010000100001000000000000001000000000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100000000010000100001000000000000001000000000100001000000000000000000000000000
11111111111111111111111111111111111111111111111111111111000011111111111000011111111111000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000000001000000000100000000010000100000000010000000001000000000000000000000000000
10000100001000010000100001000010000100001000010000000001000000000100000000010000100000000010000000001000000000000000000000000000
10000100001000010000100001000010000100001000010000000001000000000100000000010000100000000010000000001000000000000000000000000000
10000100001000010000100001000010000100001000010000000001000000000100000000010000100000000010000000001000000000000000000000000000
11111111111111111111111111111111111111111111110000100001111110000100001111111111100001111111111111111000000000000000000000000000
10000100001000010000100001000010000100001000010000100000000010000000001000000000000001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100000000010000000001000000000000001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100000000010000000001000000000000001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100000000010000000001000000000000001000010000100001000000000000000000000000000
11111111111111111111111111111111111111111111110000111111000011111111111000011111111111111111111111111000000000000000000000000000
10000100001000010000100001000010000000000000000000100000000010000100001000000000100000000010000100001000000000000000000000000000
10000100001000010000100001000010000000000000000000100000000010000100001000000000100000000010000100001000000000000000000000000000
10000100001000010000100001000010000000000000000000100000000010000100001000000000100000000010000100001000000000000000000000000000
10000100001000010000100001000010000000000000000000100000000010000100001000000000100000000010000100001000000000000000000000000000
11111111111111111111111111111110000111111111111111100001111111111111111111110000100001000011111111111000000000000000000000000000
10000100001000010000100001000010000000001000000000000001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000000001000000700000001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000000001000000000000001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000000001000000000000001000010000100001000010000100001000010000100001000000000000000000000000000
11111111111111111111111111111111111100001000000000111111111111111111111111110000100001000011111111111000000000000000000000000000
10000100001000010000100001000010000100001000000000100001000010000100001000000000100001000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000000000100001000010000100001000000000100001000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000000000100001000010000100001000000000100001000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000000000100001000010000100001000000000100001000000000000001000000000000000000000000000
11111111111111111111111111111111111100001111111111111111111111111111111000011111100001111111111100001000000000000000000000000000
10000100001000010000100001000010000100000000010000100001000010000100001000000000000001000000000000001000000000000000000000000000
10000100001000010000100001000010000100000000010000100001000010000100001000000000000001000000000000001000000000000000000000000000
10000100001000010000100001000010000100000000010000100001000010000100001000000000000001000000000000001000000000000000000000000000
10000100001000010000100001000010000100000000010000100001000010000100001000000000000001000000000000001000000000000000000000000000
11111111111111111111111111111111111111111000011111111111111111111111111111111111111111000011111111111000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000000001000010000000001000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000000001000010000000001000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000000001000010000000001000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000000001000010000000001000000000000001000000000000000000000000000
11111111111111111111111111111111111111111000011111111111111110000100001111110000100001111111111100001000000000000000000000000000
10000100001000010000100001000010000100001000010000000000000010000100000000000000100000000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000000000000010000100000000000000100000000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000000000000010000100000000000000100000000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000000000000010000100000000000000100000000010000100001000000000000000000000000000
11111111111111111111111111111111111111111000010000111111000010000111111111111111111111000011111100001000000000000000000000000000
10000100001000010000100001000010000100001000000000100001000000000100001000010000100001000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000000000100001000000000100001000010000100001000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000000000100001000000000100001000010000100001000000000000001000000000000000000000000000
10000100001000010000100001000010000100001000000000100001000000000100001000010000100001000000000000001000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
10000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

